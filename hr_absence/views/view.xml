<?xml version="1.0" encoding="utf-8"?>
<odoo>
  <!-- Smart button on Employee -->
  <record id="view_employee_form_inherit_daylines" model="ir.ui.view">
    <field name="name">hr.employee.form.daylines</field>
    <field name="model">hr.employee</field>
    <field name="inherit_id" ref="hr.view_employee_form"/>
    <field name="arch" type="xml">
      <xpath expr="//div[@name='button_box']" position="inside">
        <button class="oe_stat_button" type="object" name="action_open_daylines"
                icon="fa-calendar-times-o">
          <field string="Absences" name="absence_day_count" widget="statinfo"/>
        </button>
      </xpath>
    </field>
  </record>

  <!-- Daylines list -->
  <record id="view_hr_attendance_dayline_list" model="ir.ui.view">
    <field name="name">hr.attendance.dayline.list</field>
    <field name="model">hr.attendance.dayline</field>
    <field name="arch" type="xml">
      <list string="Attendance Daylines" decoration-danger="status == 'absent'"
            decoration-warning="status == 'partial'" decoration-success="status == 'present'">
        <field name="date"/>
        <field name="employee_id"/>
        <field name="status"/>
        <field name="minutes_expected"/>
        <field name="minutes_attended"/>
        <field name="minutes_late"/>
        <field name="minutes_early"/>
        <field name="shift_start"/>
        <field name="shift_end"/>
        <field name="attendance_id"/>
        <field name="notes"/>
      </list>
    </field>
  </record>

  <!-- Daylines Search -->
  <record id="view_hr_attendance_dayline_search" model="ir.ui.view">
    <field name="name">hr.attendance.dayline.search</field>
    <field name="model">hr.attendance.dayline</field>
    <field name="arch" type="xml">
      <search>
        <field name="employee_id"/>
        <field name="status"/>
        <filter name="this_month" string="This Month" context="{'search_default_this_month': 1}"
                domain="['&',('date','&gt;=', context_today().replace(day=1)),('date','&lt;=', context_today())]"/>
        <group expand="0" string="Group By">
          <filter name="grp_emp" string="Employee" context="{'group_by':'employee_id'}"/>
          <filter name="grp_date" string="Date" context="{'group_by':'date'}"/>
          <filter name="grp_status" string="Status" context="{'group_by':'status'}"/>
        </group>
      </search>
    </field>
  </record>

  <!-- Daylines Action -->
  <record id="action_hr_attendance_daylines" model="ir.actions.act_window">
    <field name="name">Attendance Daylines</field>
    <field name="res_model">hr.attendance.dayline</field>
    <field name="view_mode">list,graph,pivot,form</field>
    <field name="context">{'search_default_this_month': 1}</field>
  </record>

  <!-- Menu: under Attendances -->
  <menuitem id="menu_hr_attendance_daylines_root" name="Attendance Daylines"
            parent="hr_attendance.menu_hr_attendance_configuration" action="action_hr_attendance_daylines"
            sequence="60"/>

  <!-- OPTIONAL: add day_status to hr.attendance list -->
  <record id="view_hr_attendance_list_inherit_status" model="ir.ui.view">
    <field name="name">hr.attendance.list.daystatus</field>
    <field name="model">hr.attendance</field>
    <field name="inherit_id" ref="hr_attendance.hr_attendance_view_list"/>
    <field name="arch" type="xml">
      <xpath expr="//list/field[@name='check_out']" position="after">
        <field name="day_status"/>
      </xpath>
    </field>
  </record>
</odoo>
